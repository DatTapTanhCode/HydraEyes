<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hydra Eyes - Camera Monitoring Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style_main.css') }}">
</head>
<body>
    <div class="dashboard-container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="logo">
                <div class="logo-icon">üëÅÔ∏è</div>
                <div class="logo-text">Hydra Eyes</div>
            </div>
            
            <nav class="nav-menu">
                <div class="nav-item active" data-page="dashboard">
                    <span class="nav-icon">üìä</span>
                    Dashboard
                </div>
                <div class="nav-item" data-page="cameras">
                    <span class="nav-icon">üìπ</span>
                    Cameras
                </div>
                <div class="nav-item" data-page="teams">
                    <span class="nav-icon">üë•</span>
                    Teams
                </div>
                <div class="nav-item" data-page="alerts">
                    <span class="nav-icon">üö®</span>
                    Alerts
                </div>
                <div class="nav-item" data-page="settings">
                    <span class="nav-icon">‚öôÔ∏è</span>
                    Settings
                </div>
            </nav>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Header -->
            <header class="header">
                <h1 class="header-title">Hello {{ user.name if user else 'User' }}</h1>
                <div class="header-actions">
                    <button class="logout-btn" onclick="logout()">
                        Logout
                    </button>
                    <div class="profile-avatar">üë§</div>
                </div>
            </header>

            <!-- Dashboard Content -->
            <div class="content" id="dashboard-content">
                <!-- Stats Grid -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-header">Cameras Online</div>
                        <div class="stat-value">
                            <span class="stat-icon icon-green"></span>
                            <span id="cameras-online">{{ camera_data.cameras_online if camera_data else 0 }}</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">Total Cameras</div>
                        <div class="stat-value">
                            <span class="stat-icon icon-blue"></span>
                            <span id="total-cameras">{{ camera_data.total_cameras if camera_data else 0 }}</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">Threshold Alerts</div>
                        <div class="stat-value">
                            <span class="stat-icon icon-red"></span>
                            <span id="threshold-alerts">{{ camera_data.alerts_threshold if camera_data else 0 }}</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-header">System Uptime</div>
                        <div class="stat-value">
                            <span class="stat-icon icon-purple"></span>
                            <span id="system-uptime">{{ camera_data.system_uptime if camera_data else 99.7 }}%</span>
                        </div>
                    </div>
                </div>

                <!-- Camera Status Section -->
                <div class="camera-status-section">
                    <div class="camera-status-header">
                        <h3>System Status</h3>
                        <span style="font-size: 12px; color: #64748b;">Last updated: <span id="last-update">now</span></span>
                    </div>
                    <div class="status-location">
                        <span>System Status Overview</span>
                        <div class="status-indicator"></div>
                        <span>All Systems Operational</span>
                    </div>
                    <div class="status-cards">
                        <div class="status-card status-online">
                            <div class="status-value" id="online-count">0</div>
                            <div class="status-label">Online Cameras</div>
                            <div class="status-detail">Currently monitoring gauges</div>
                        </div>
                        <div class="status-card status-offline">
                            <div class="status-value" id="offline-count">0</div>
                            <div class="status-label">Offline Cameras</div>
                            <div class="status-detail">Require attention</div>
                        </div>
                        <div class="status-card status-alert">
                            <div class="status-value" id="alert-count">0</div>
                            <div class="status-label">Active Alerts</div>
                            <div class="status-detail">Threshold exceeded</div>
                        </div>
                        <div class="status-card status-normal">
                            <div class="status-value" id="normal-count">0</div>
                            <div class="status-label">Normal Status</div>
                            <div class="status-detail">Within parameters</div>
                        </div>
                    </div>
                </div>

                <!-- Individual Real-time Charts -->
                <div class="section-header">
                    <h2 class="section-title">Real-time Readings (Last 30 seconds)</h2>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <span style="font-size: 12px; color: #64748b;">Auto-refresh: ON</span>
                    </div>
                </div>

                <div class="charts-grid" id="chartsGrid">
                    <!-- Individual charts will be populated here dynamically -->
                    <div class="no-charts-message">
                        <div class="icon">üìä</div>
                        <div><strong>No cameras configured</strong></div>
                        <div>Add cameras to see real-time charts</div>
                    </div>
                </div>
                
                <!-- AI Predictions Section -->
                <div class="ai-predictions-section">
                    <div class="section-header">
                        <h2 class="section-title">ü§ñ AI Predictions & Analysis</h2>
                        <div style="display: flex; gap: 10px; align-items: center;">
                            <label class="switch">
                                <input type="checkbox" id="ai-predictions-toggle" checked>
                                <span class="slider"></span>
                            </label>
                            <span style="font-size: 14px; color: #64748b;">AI Predictions</span>
                        </div>
                    </div>

                    <!-- Prediction Cards Grid -->
                    <div class="predictions-grid" id="predictions-grid">
                        <!-- Predictions will be populated by JavaScript -->
                    </div>

                    <!-- Analysis Summary -->
                    <div class="analysis-summary" id="analysis-summary" style="display: none;">
                        <div class="summary-header">
                            <h3>üìä System Analysis Summary</h3>
                            <button class="generate-summary-btn" onclick="generateAISummary()">
                                Generate AI Summary
                            </button>
                        </div>
                        <div class="summary-content" id="summary-content">
                            <div class="summary-placeholder">
                                Click "Generate AI Summary" to get an AI-powered analysis of your system performance.
                            </div>
                        </div>
                    </div>
                </div>

                <!-- AI Predictions Toggle Switch Styles -->
                <style>
                .ai-predictions-section {
                    background: white;
                    border-radius: 12px;
                    border: 1px solid #e2e8f0;
                    margin-bottom: 2rem;
                    overflow: hidden;
                }

                .predictions-grid {
                    display: grid;
                    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
                    gap: 1rem;
                    padding: 1.5rem;
                }

                .prediction-card {
                    background: linear-gradient(135deg, #f8fafc, #f1f5f9);
                    border: 1px solid #e2e8f0;
                    border-radius: 8px;
                    padding: 1rem;
                    position: relative;
                    transition: all 0.2s ease;
                }

                .prediction-card:hover {
                    transform: translateY(-2px);
                    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
                }

                .prediction-card.warning {
                    border-left: 4px solid #f59e0b;
                    background: linear-gradient(135deg, #fefbf2, #fef3c7);
                }

                .prediction-card.danger {
                    border-left: 4px solid #ef4444;
                    background: linear-gradient(135deg, #fef2f2, #fee2e2);
                }

                .prediction-card.normal {
                    border-left: 4px solid #10b981;
                    background: linear-gradient(135deg, #f0fdf4, #dcfce7);
                }

                .prediction-header {
                    display: flex;
                    justify-content: between;
                    align-items: center;
                    margin-bottom: 8px;
                }

                .prediction-title {
                    font-weight: 600;
                    color: #1e293b;
                    font-size: 14px;
                }

                .prediction-confidence {
                    font-size: 12px;
                    color: #64748b;
                    background: rgba(255, 255, 255, 0.7);
                    padding: 2px 6px;
                    border-radius: 4px;
                }

                .prediction-values {
                    display: grid;
                    grid-template-columns: 1fr 1fr;
                    gap: 8px;
                    margin-bottom: 8px;
                }

                .value-item {
                    text-align: center;
                    padding: 8px;
                    background: rgba(255, 255, 255, 0.5);
                    border-radius: 6px;
                }

                .value-label {
                    font-size: 11px;
                    color: #64748b;
                    margin-bottom: 2px;
                }

                .value-number {
                    font-size: 16px;
                    font-weight: 600;
                    color: #1e293b;
                }

                .prediction-trend {
                    display: flex;
                    align-items: center;
                    gap: 4px;
                    font-size: 12px;
                    color: #64748b;
                }

                .trend-arrow {
                    font-size: 14px;
                }

                .trend-up { color: #ef4444; }
                .trend-down { color: #10b981; }
                .trend-stable { color: #64748b; }

                /* Toggle Switch */
                .switch {
                    position: relative;
                    display: inline-block;
                    width: 48px;
                    height: 24px;
                }

                .switch input {
                    opacity: 0;
                    width: 0;
                    height: 0;
                }

                .slider {
                    position: absolute;
                    cursor: pointer;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                    background-color: #ccc;
                    transition: .4s;
                    border-radius: 24px;
                }

                .slider:before {
                    position: absolute;
                    content: "";
                    height: 18px;
                    width: 18px;
                    left: 3px;
                    bottom: 3px;
                    background-color: white;
                    transition: .4s;
                    border-radius: 50%;
                }

                input:checked + .slider {
                    background-color: #dc2626;
                }

                input:checked + .slider:before {
                    transform: translateX(24px);
                }

                /* Analysis Summary */
                .analysis-summary {
                    border-top: 1px solid #e2e8f0;
                    background: #f8fafc;
                }

                .summary-header {
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    padding: 1rem 1.5rem;
                    border-bottom: 1px solid #e2e8f0;
                }

                .summary-header h3 {
                    color: #1e293b;
                    font-size: 16px;
                    margin: 0;
                }

                .generate-summary-btn {
                    background: linear-gradient(135deg, #4F46E5, #7C3AED);
                    color: white;
                    border: none;
                    padding: 8px 16px;
                    border-radius: 6px;
                    font-size: 12px;
                    font-weight: 500;
                    cursor: pointer;
                    transition: all 0.2s ease;
                }

                .generate-summary-btn:hover {
                    transform: translateY(-1px);
                    box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3);
                }

                .summary-content {
                    padding: 1.5rem;
                    color: #374151;
                    line-height: 1.6;
                }

                .summary-placeholder {
                    text-align: center;
                    color: #64748b;
                    font-style: italic;
                }

                .summary-stats {
                    display: grid;
                    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                    gap: 1rem;
                    margin-bottom: 1rem;
                }

                .stat-box {
                    background: white;
                    border: 1px solid #e2e8f0;
                    border-radius: 6px;
                    padding: 1rem;
                    text-align: center;
                }

                .stat-number {
                    font-size: 24px;
                    font-weight: 600;
                    color: #1e293b;
                    margin-bottom: 4px;
                }

                .stat-label {
                    font-size: 12px;
                    color: #64748b;
                }

                /* Charts Grid Styling */
                .charts-grid {
                    display: grid;
                    grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
                    gap: 1.5rem;
                    margin-bottom: 2rem;
                }

                .individual-chart {
                    background: white;
                    border-radius: 12px;
                    border: 1px solid #e2e8f0;
                    overflow: hidden;
                    transition: all 0.2s ease;
                }

                .individual-chart:hover {
                    transform: translateY(-2px);
                    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
                }

                .chart-header {
                    background: #f8fafc;
                    padding: 1rem;
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    border-bottom: 1px solid #e2e8f0;
                }

                .chart-title {
                    font-weight: 600;
                    color: #1e293b;
                    font-size: 14px;
                }

                .chart-status {
                    font-size: 12px;
                    padding: 4px 8px;
                    border-radius: 4px;
                    font-weight: 500;
                }

                .chart-container {
                    height: 200px;
                    position: relative;
                    padding: 10px;
                }

                .chart-info {
                    background: #f8fafc;
                    padding: 0.75rem 1rem;
                    display: flex;
                    justify-content: space-between;
                    align-items: center;
                    border-top: 1px solid #e2e8f0;
                    font-size: 12px;
                    color: #64748b;
                }

                .current-reading {
                    font-weight: 600;
                    color: #1e293b;
                }

                .no-charts-message {
                    grid-column: 1 / -1;
                    display: flex;
                    flex-direction: column;
                    align-items: center;
                    justify-content: center;
                    padding: 3rem;
                    background: white;
                    border-radius: 12px;
                    border: 2px dashed #e2e8f0;
                    text-align: center;
                    color: #64748b;
                    min-height: 200px;
                }

                .no-charts-message .icon {
                    font-size: 48px;
                    margin-bottom: 16px;
                    opacity: 0.5;
                }

                @media (max-width: 768px) {
                    .charts-grid {
                        grid-template-columns: 1fr;
                        gap: 1rem;
                    }
                    
                    .individual-chart {
                        min-width: 0;
                    }
                    
                    .chart-container {
                        height: 150px;
                    }
                    
                    .predictions-grid {
                        grid-template-columns: 1fr;
                        padding: 1rem;
                    }
                    
                    .summary-header {
                        flex-direction: column;
                        gap: 12px;
                        align-items: flex-start;
                    }
                }
                </style>

                <!-- JavaScript Functions for AI Predictions -->
                <script>
                // Add these functions to your existing script_main.js

                // Generate AI predictions for all cameras
                function generateAIPredictions() {
                    const predictionsContainer = document.getElementById('predictions-grid');
                    
                    if (cameras.length === 0) {
                        predictionsContainer.innerHTML = `
                            <div style="grid-column: 1 / -1; text-align: center; color: #64748b; padding: 2rem;">
                                No cameras available for predictions
                            </div>
                        `;
                        return;
                    }
                    
                    const predictions = cameras.filter(camera => camera.address && chartData[camera.id]).map(camera => {
                        const data = chartData[camera.id];
                        if (!data || data.length < 3) return null;
                        
                        const prediction = predictNextValue(data);
                        const currentValue = gaugeReadings[camera.id] || 0;
                        const predictionStatus = getDetailedStatus(prediction, camera);
                        const confidence = calculatePredictionConfidence(data);
                        const trend = calculateTrend(data);
                        
                        return {
                            camera,
                            prediction,
                            currentValue,
                            status: predictionStatus,
                            confidence,
                            trend
                        };
                    }).filter(Boolean);
                    
                    if (predictions.length === 0) {
                        predictionsContainer.innerHTML = `
                            <div style="grid-column: 1 / -1; text-align: center; color: #64748b; padding: 2rem;">
                                Collecting data for predictions...
                            </div>
                        `;
                        return;
                    }
                    
                    const predictionsHTML = predictions.map(pred => {
                        const config = gaugeConfigs[pred.camera.type];
                        const trendIcon = pred.trend.direction === 'up' ? '‚ÜóÔ∏è' : 
                                        pred.trend.direction === 'down' ? '‚ÜòÔ∏è' : '‚û°Ô∏è';
                        const trendClass = pred.trend.direction === 'up' ? 'trend-up' : 
                                        pred.trend.direction === 'down' ? 'trend-down' : 'trend-stable';
                        
                        return `
                            <div class="prediction-card ${pred.status.status}">
                                <div class="prediction-header">
                                    <div class="prediction-title">${pred.camera.id} - ${pred.camera.location}</div>
                                    <div class="prediction-confidence">${pred.confidence}% confidence</div>
                                </div>
                                <div class="prediction-values">
                                    <div class="value-item">
                                        <div class="value-label">Current</div>
                                        <div class="value-number">${pred.currentValue.toFixed(1)}${config.unit}</div>
                                    </div>
                                    <div class="value-item">
                                        <div class="value-label">Predicted</div>
                                        <div class="value-number">${pred.prediction.toFixed(1)}${config.unit}</div>
                                    </div>
                                </div>
                                <div class="prediction-trend">
                                    <span class="trend-arrow ${trendClass}">${trendIcon}</span>
                                    <span>Trending ${pred.trend.direction} (${pred.trend.rate.toFixed(1)}% change)</span>
                                </div>
                            </div>
                        `;
                    }).join('');
                    
                    predictionsContainer.innerHTML = predictionsHTML;
                }

                // Calculate prediction confidence based on data consistency
                function calculatePredictionConfidence(dataPoints) {
                    if (dataPoints.length < 3) return 50;
                    
                    const recent = dataPoints.slice(-5);
                    const values = recent.map(p => p.value);
                    const mean = values.reduce((a, b) => a + b) / values.length;
                    const variance = values.reduce((a, b) => a + Math.pow(b - mean, 2)) / values.length;
                    const stdDev = Math.sqrt(variance);
                    
                    // Lower standard deviation = higher confidence
                    const confidence = Math.max(60, Math.min(95, 95 - (stdDev * 10)));
                    return Math.round(confidence);
                }

                // Calculate trend direction and rate
                function calculateTrend(dataPoints) {
                    if (dataPoints.length < 3) return { direction: 'stable', rate: 0 };
                    
                    const recent = dataPoints.slice(-3);
                    const firstValue = recent[0].value;
                    const lastValue = recent[recent.length - 1].value;
                    const change = ((lastValue - firstValue) / firstValue) * 100;
                    
                    return {
                        direction: change > 2 ? 'up' : change < -2 ? 'down' : 'stable',
                        rate: Math.abs(change)
                    };
                }

                // Generate AI summary (placeholder - integrate with your preferred AI service)
                function generateAISummary() {
                    const summaryContent = document.getElementById('summary-content');
                    const analysisSection = document.getElementById('analysis-summary');
                    
                    // Show the section
                    analysisSection.style.display = 'block';
                    
                    // Show loading state
                    summaryContent.innerHTML = `
                        <div style="text-align: center; padding: 2rem;">
                            <div class="loading-spinner"></div>
                            <div style="margin-top: 1rem; color: #64748b;">Generating AI analysis...</div>
                        </div>
                    `;
                    
                    // Simulate AI analysis (replace with actual AI service call)
                    setTimeout(() => {
                        const stats = calculateSystemStats();
                        const summary = generateSystemSummary(stats);
                        
                        summaryContent.innerHTML = `
                            <div class="summary-stats">
                                <div class="stat-box">
                                    <div class="stat-number">${stats.totalReadings}</div>
                                    <div class="stat-label">Total Readings</div>
                                </div>
                                <div class="stat-box">
                                    <div class="stat-number">${stats.warningCount}</div>
                                    <div class="stat-label">Warning Events</div>
                                </div>
                                <div class="stat-box">
                                    <div class="stat-number">${stats.dangerCount}</div>
                                    <div class="stat-label">Danger Events</div>
                                </div>
                                <div class="stat-box">
                                    <div class="stat-number">${stats.systemHealth}%</div>
                                    <div class="stat-label">System Health</div>
                                </div>
                            </div>
                            <div>${summary}</div>
                        `;
                    }, 2000);
                }

                // Calculate system statistics
                function calculateSystemStats() {
                    const totalReadings = Object.values(chartData).reduce((sum, data) => sum + data.length, 0);
                    let warningCount = 0;
                    let dangerCount = 0;
                    
                    cameras.forEach(camera => {
                        const data = chartData[camera.id] || [];
                        data.forEach(point => {
                            const status = getDetailedStatus(point.value, camera);
                            if (status.status === 'warning') warningCount++;
                            if (status.status === 'danger') dangerCount++;
                        });
                    });
                    
                    const systemHealth = Math.max(0, 100 - (warningCount * 2) - (dangerCount * 5));
                    
                    return { totalReadings, warningCount, dangerCount, systemHealth };
                }

                // Generate system summary text
                function generateSystemSummary(stats) {
                    let summary = "<h4>System Performance Analysis</h4>";
                    
                    if (stats.systemHealth >= 90) {
                        summary += "<p style='color: #16a34a;'>‚úÖ <strong>Excellent:</strong> Your system is performing optimally with minimal alerts. All cameras are operating within normal parameters.</p>";
                    } else if (stats.systemHealth >= 70) {
                        summary += "<p style='color: #ca8a04;'>‚ö†Ô∏è <strong>Good:</strong> System performance is generally stable, but there have been some warning events that should be monitored.</p>";
                    } else {
                        summary += "<p style='color: #dc2626;'>üö® <strong>Attention Required:</strong> The system has experienced multiple alerts. Immediate review and potential maintenance may be needed.</p>";
                    }
                    
                    summary += `
                        <h4>Key Insights</h4>
                        <ul style="margin-left: 1rem; color: #374151;">
                            <li>Processed ${stats.totalReadings} total readings across all cameras</li>
                            <li>${stats.warningCount} warning events detected (values approaching thresholds)</li>
                            <li>${stats.dangerCount} critical events recorded (values exceeding safety limits)</li>
                            <li>Overall system reliability: ${stats.systemHealth}%</li>
                        </ul>
                        
                        <h4>Recommendations</h4>
                        <ul style="margin-left: 1rem; color: #374151;">
                            <li>Monitor cameras with frequent threshold violations</li>
                            <li>Consider adjusting thresholds if false positives are common</li>
                            <li>Schedule maintenance for cameras showing irregular patterns</li>
                            <li>Review team member assignments for critical gauges</li>
                        </ul>
                    `;
                    
                    return summary;
                }

                // Toggle AI predictions on/off
                document.addEventListener('DOMContentLoaded', function() {
                    const aiToggle = document.getElementById('ai-predictions-toggle');
                    if (aiToggle) {
                        aiToggle.addEventListener('change', function() {
                            if (this.checked) {
                                // Start generating predictions every 5 seconds
                                setInterval(generateAIPredictions, 5000);
                                generateAIPredictions(); // Generate immediately
                            }
                        });
                        
                        // Initialize if checked
                        if (aiToggle.checked) {
                            setInterval(generateAIPredictions, 5000);
                            setTimeout(generateAIPredictions, 3000); // First generation after 3 seconds
                        }
                    }
                });
                </script>

                <!-- Latest Alerts -->
                <div class="section-header">
                    <h2 class="section-title">Latest Alerts</h2>
                    <a href="#" class="see-all-btn" onclick="switchToPage('alerts')">See All</a>
                </div>

                <div class="alerts-table">
                    <div class="table-header">
                        <div>Camera</div>
                        <div>Alert Time</div>
                        <div>Duration</div>
                        <div>Threshold</div>
                        <div></div>
                    </div>
                    <div id="recent-alerts-list">
                        <div class="table-row" style="text-align: center; color: #64748b; grid-column: 1 / -1; padding: 2rem;">
                            No recent alerts
                        </div>
                    </div>
                </div>
            </div>

            <!-- Camera Management Content -->
            <div class="content hidden" id="cameras-content">
                <div class="section-header">
                    <h2 class="section-title">Camera Management</h2>
                    <button class="add-camera-btn" onclick="showAddCameraModal()">
                        <span class="add-icon">+</span>
                        Add Camera
                    </button>
                </div>

                <div class="camera-feeds" id="cameraFeeds">
                    <!-- Cameras will be rendered here dynamically -->
                </div>
            </div>

            <!-- Teams Content -->
            <div class="content hidden" id="teams-content">
                <div class="section-header">
                    <h2 class="section-title">Team Management</h2>
                    <button class="add-team-btn" onclick="showAddTeamModal()">
                        <span class="add-icon">+</span>
                        Add Team Member
                    </button>
                </div>

                <div class="teams-grid" id="teamsGrid">
                    <!-- Teams will be rendered here dynamically -->
                </div>
            </div>

            <!-- Alerts Content -->
            <div class="content hidden" id="alerts-content">
                <div class="section-header">
                    <h2 class="section-title">System Alerts & Activity</h2>
                    <span style="font-size: 14px; color: #64748b;">Real-time monitoring and activity logs</span>
                </div>

                <div class="alerts-section">
                    <!-- Activity Log -->
                    <div class="log-box">
                        <div class="log-header">
                            <span>üìã Activity Log</span>
                            <span style="font-size: 12px; color: #64748b;" id="activity-count">0 entries</span>
                        </div>
                        <div class="log-content" id="activity-log">
                            <div class="empty-log">
                                <div class="icon">üìù</div>
                                <div><strong>No activity yet</strong></div>
                                <div>System activities will appear here</div>
                            </div>
                        </div>
                    </div>

                    <!-- Alert Log -->
                    <div class="log-box">
                        <div class="log-header">
                            <span>üö® Alert Log</span>
                            <span style="font-size: 12px; color: #64748b;" id="alert-log-count">0 alerts</span>
                        </div>
                        <div class="log-content" id="alert-log">
                            <div class="empty-log">
                                <div class="icon">üîî</div>
                                <div><strong>No alerts yet</strong></div>
                                <div>Threshold alerts will appear here</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Settings Content -->
            <div class="content hidden" id="settings-content">
                <div class="blank-content">
                    <h2>‚öôÔ∏è Settings</h2>
                    <p>System configuration and user preferences interface will be available here.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Camera Modal -->
    <div class="modal-overlay" id="cameraModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Add New Camera</h3>
                <button class="modal-close" onclick="hideAddCameraModal()">&times;</button>
            </div>
            <form id="cameraForm">
                <div class="form-group">
                    <label class="form-label">
                        <input type="checkbox" id="demoMode" style="margin-right: 8px;">
                        Demo Mode (Use simulated data instead of real camera)
                    </label>
                    <small style="color: #64748b; display: block; margin-top: 4px;">
                        Check this to use random generated data for testing. Uncheck to use real camera with detector.
                    </small>
                </div>
                
                <div class="form-group" id="addressGroup">
                    <label class="form-label">Camera Address/URL</label>
                    <input type="text" id="cameraAddress" class="form-input" 
                        placeholder="Enter camera IP or URL (e.g., 192.168.1.100 or http://camera-url)" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Detector Type</label>
                    <select id="detectorType" class="form-select" required>
                        <option value="">Select detector type</option>
                        <option value="digital">Digital Gauge Detector (OCR-based)</option>
                        <option value="analog">Analog Gauge Detector (Needle-based)</option>
                    </select>
                    <small style="color: #64748b; display: block; margin-top: 4px;">
                        <strong>Digital:</strong> For digital displays and numeric gauges<br>
                        <strong>Analog:</strong> For traditional needle-based analog gauges
                    </small>
                </div>

                <div class="form-group">
                    <label class="form-label">Gauge Type</label>
                    <select id="gaugeType" class="form-select" required>
                        <option value="">Select gauge type</option>
                        <option value="pressure">Pressure Gauge</option>
                        <option value="temperature">Temperature Gauge</option>
                        <option value="flow">Flow Gauge</option>
                        <option value="level">Level Gauge</option>
                        <option value="digital">Digital Display</option>
                        <option value="analog">Analog Gauge</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Location</label>
                    <input type="text" id="cameraLocation" class="form-input" 
                        placeholder="Enter camera location (e.g., Pump Room A)" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Threshold Value</label>
                    <input type="number" id="thresholdValue" class="form-input" 
                        placeholder="Enter threshold value" step="0.1" required>
                    <small style="color: #64748b; display: block; margin-top: 4px;">
                        Alert will trigger when reading exceeds this value
                    </small>
                </div>

                <!-- Information box for analog cameras -->
                <div id="calibrationInfo" style="display: none;">
                    <div style="background: #fef3c7; border: 1px solid #f59e0b; border-radius: 6px; padding: 8px; margin-top: 8px; font-size: 12px; color: #92400e;">
                        ‚ÑπÔ∏è Analog gauges require manual calibration after setup. You'll need to click on visible numbers on the gauge.
                    </div>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn btn-cancel" onclick="hideAddCameraModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Add Camera</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Camera Config Modal (also needs detector type) -->
    <div class="modal-overlay" id="configModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Configure Camera</h3>
                <button class="modal-close" onclick="hideConfigModal()">&times;</button>
            </div>
            <form id="configForm">
                <div class="form-group">
                    <label class="form-label">
                        <input type="checkbox" id="configDemoMode" style="margin-right: 8px;">
                        Demo Mode
                    </label>
                </div>
                
                <div class="form-group" id="configAddressGroup">
                    <label class="form-label">Camera Address/URL</label>
                    <input type="text" id="configCameraAddress" class="form-input" 
                        placeholder="Enter camera IP or URL" required>
                </div>

                <div class="form-group">
                    <label class="form-label">Detector Type</label>
                    <select id="configDetectorType" class="form-select" required>
                        <option value="">Select detector type</option>
                        <option value="digital">Digital Gauge Detector</option>
                        <option value="analog">Analog Gauge Detector</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Gauge Type</label>
                    <select id="configGaugeType" class="form-select" required>
                        <option value="">Select gauge type</option>
                        <option value="pressure">Pressure Gauge</option>
                        <option value="temperature">Temperature Gauge</option>
                        <option value="flow">Flow Gauge</option>
                        <option value="level">Level Gauge</option>
                        <option value="digital">Digital Display</option>
                        <option value="analog">Analog Gauge</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Location</label>
                    <input type="text" id="configCameraLocation" class="form-input" 
                        placeholder="Enter camera location" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Threshold Value</label>
                    <input type="number" id="configThresholdValue" class="form-input" 
                        placeholder="Enter threshold value" step="0.1" required>
                </div>
                
                <div class="modal-actions">
                    <button type="button" class="btn btn-cancel" onclick="hideConfigModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Update Camera</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Team Member Modal -->
    <div class="modal-overlay" id="teamModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Add Team Member</h3>
                <button class="modal-close" onclick="hideAddTeamModal()">&times;</button>
            </div>
            <form id="teamForm">
                <div class="form-group">
                    <label class="form-label">Full Name</label>
                    <input type="text" id="teamName" class="form-input" placeholder="Enter full name" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Email Address</label>
                    <input type="email" id="teamEmail" class="form-input" placeholder="Enter email address" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Contact Number</label>
                    <input type="tel" id="teamContact" class="form-input" placeholder="Enter phone number" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Assigned Gauges</label>
                    <div class="checkbox-group" id="gaugeCheckboxes">
                        <!-- Will be populated dynamically -->
                    </div>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-cancel" onclick="hideAddTeamModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Add Member</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Analog Calibration Modal -->
    <div class="modal-overlay" id="analogCalibrationModal">
        <div class="modal" style="width: 900px; max-width: 95vw;">
            <div class="modal-header">
                <h3 class="modal-title">Analog Gauge Calibration</h3>
                <button class="modal-close" onclick="hideAnalogCalibrationModal()">&times;</button>
            </div>
            <div style="padding: 1rem;">
                <!-- Calibration Settings -->
                <div class="calibration-settings" style="background: #f8fafc; border: 1px solid #e2e8f0; border-radius: 8px; padding: 1rem; margin-bottom: 1rem;">
                    <h4 style="margin: 0 0 0.5rem 0; color: #1e293b;">üìê Calibration Settings</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; align-items: center;">
                        <div>
                            <label for="calibrationPointsCount" style="display: block; font-size: 14px; font-weight: 500; color: #374151; margin-bottom: 4px;">Number of Calibration Points:</label>
                            <select id="calibrationPointsCount" style="width: 100%; padding: 6px 8px; border: 1px solid #d1d5db; border-radius: 4px; font-size: 14px;" onchange="updateCalibrationRequirements()">
                                <option value="2">2 Points (Minimum)</option>
                                <option value="3">3 Points (Good)</option>
                                <option value="4" selected>4 Points (Recommended)</option>
                                <option value="5">5 Points (High Accuracy)</option>
                                <option value="6">6 Points (Maximum)</option>
                            </select>
                        </div>
                        <div style="display: flex; gap: 8px;">
                            <button type="button" class="btn-secondary" onclick="undoLastPoint()" id="undoBtn" disabled title="Remove the last calibration point">
                                ‚Ü∂ Undo Last
                            </button>
                            <button type="button" class="btn-warning" onclick="resetAllPoints()" id="resetBtn" disabled title="Clear all calibration points">
                                üóëÔ∏è Reset All
                            </button>
                        </div>
                    </div>
                </div>

                <div class="calibration-instructions" id="calibrationInstructions">
                    <h4>üéØ Calibration Instructions</h4>
                    <p>1. Select the number of calibration points you want to use (more points = better accuracy)</p>
                    <p>2. Wait for the gauge to be detected and stable</p>
                    <p>3. Click on the numbers visible on your gauge (spread across the gauge range)</p>
                    <p>4. Enter the corresponding value for each click</p>
                    <p>5. Use "Undo Last" to remove mistakes or "Reset All" to start over</p>
                </div>
                
                <div class="video-container" style="margin: 1rem 0; text-align: center;">
                    <img id="analogVideoFeed" 
                        src="" 
                        alt="Analog gauge feed" 
                        style="max-width: 100%; height: auto; border: 2px solid #e2e8f0; border-radius: 8px; cursor: crosshair;"
                        onclick="handleAnalogClick(event)">
                    <div id="videoStatus" style="margin-top: 8px; color: #64748b; font-size: 14px;">
                        Initializing video feed...
                    </div>
                </div>

                <div class="calibration-status" id="calibrationStatus">
                    <h4>Status: <span id="calibrationStatusText">Waiting for stable gauge...</span></h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem; margin-top: 1rem;">
                        <div>
                            <strong>Points Collected:</strong> <span id="pointsCollected">0</span>/<span id="pointsRequired">4</span>
                        </div>
                        <div>
                            <strong>Current Reading:</strong> <span id="currentAnalogReading">--</span>
                        </div>
                        <div>
                            <strong>Progress:</strong> <span id="calibrationProgress">0%</span>
                        </div>
                    </div>
                    <div class="calibration-progress" style="margin-top: 8px;">
                        <div class="calibration-progress-bar" id="calibrationProgressBar" style="width: 0%;"></div>
                    </div>
                </div>

                <div class="calibration-log" id="calibrationLog" style="max-height: 200px; overflow-y: auto; margin-top: 1rem;">
                    <h4>Calibration Points History</h4>
                    <div id="calibrationPoints" style="font-family: 'Courier New', monospace; font-size: 12px; white-space: pre-line;">
                        <div style="color: #64748b; font-style: italic;">No calibration points yet</div>
                    </div>
                </div>

                <div class="modal-actions" style="margin-top: 1.5rem; display: flex; justify-content: space-between;">
                    <div>
                        <button type="button" class="btn btn-cancel" onclick="hideAnalogCalibrationModal()">
                            ‚Üê Close Without Saving
                        </button>
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <button type="button" class="btn-secondary" onclick="testCalibration()" id="testCalibrationBtn" disabled title="Test current calibration">
                            üß™ Test Calibration
                        </button>
                        <button type="button" class="btn btn-primary" id="completeCalibrationBtn" 
                                onclick="completeAnalogCalibration()" disabled>
                            ‚úÖ Complete Calibration
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Enhanced Value Input Modal -->
    <div class="modal-overlay" id="valueInputModal">
        <div class="modal" style="width: 450px;">
            <div class="modal-header">
                <h3 class="modal-title">Enter Gauge Value</h3>
                <button class="modal-close" onclick="hideValueInputModal()">&times;</button>
            </div>
            <div style="padding: 1.5rem;">
                <div style="background: #f0f9ff; border: 1px solid #0284c7; border-radius: 6px; padding: 12px; margin-bottom: 16px;">
                    <p id="clickPositionText">Enter the value shown at the clicked position:</p>
                    <p style="font-size: 12px; color: #0369a1; margin: 4px 0 0 0;">Point <span id="currentPointNumber">1</span> of <span id="totalPointsNeeded">4</span></p>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Gauge Value</label>
                    <input type="number" id="gaugeValueInput" class="form-input" 
                        placeholder="e.g., 25.5" step="0.1" required>
                    <small style="color: #64748b; display: block; margin-top: 4px;">
                        Enter the exact number visible at the position you clicked. For better accuracy, choose values spread across the gauge range.
                    </small>
                </div>
                
                <div class="modal-actions">
                    <button type="button" class="btn btn-cancel" onclick="cancelValueInput()">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="submitGaugeValue()">Add Point</button>
                </div>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/script_main.js') }}"></script>
</body>
</html>